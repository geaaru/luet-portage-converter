# anise-portage-converter

Portage/Overlay converter for Luet specs.
Old name `luet-portage-converter`.

```
$> anise-portage-converter --help
Copyright (c) 2020-2024 - Daniele Rondina

Portage/Overlay converter for Anise specs.

Usage:
  anise-portage-converter [command]

Available Commands:
  completion       Generate the autocompletion script for the specified shell
  generate         Generate luet specs.
  help             Help about any command
  portage          Execute operations related to Portage.
  reposcan-resolve Resolve a package from reposcan tree.
  sync             Sync portage tree to anise database.

Flags:
      --backend string                 Select backend resolver: qdepends|reposcan. (default "reposcan")
  -d, --debug                          Enable debug verbosity.
      --disable-stage2                 Disable stage2 phase.
      --disable-stage3                 Disable stage3 phase.
      --disable-use-flag stringArray   Append additional use flags to disable.
      --enable-stage4                  Enable experimental stage4 phase.
  -h, --help                           help for anise-portage-converter
      --ignore-missing-deps            Ignore missing deps on resolver.
      --reposcan-files stringArray     Append additional reposcan files. Only for reposcan backend.
      --rules string                   Rules file.
  -t, --tree stringArray               Path of the tree to use.
  -v, --version                        version for anise-portage-converter

Use "anise-portage-converter [command] --help" for more information about a command.


```


`anise-portage-converter` at the moment has two different backend to generate anise specs:

  * `qdepends`: based on Gentoo qdepends tool. This backend requires that the packages must be installed on the system where is executed anise-portage-converter. It doesn't work well with overlays.
     This backend will be soon set as *deprecated*.

  * `reposcan`: based on Funtoo `reposcan` generated files. It uses the JSON files generated and doesn't require that the packages must be installed :champagne: and it support Gentoo Overlay and Funtoo Kits.


## Specifications

`anise-portage-converter` take in input a YAML rules file that is used to generate anise specs.

### Example

```yaml
skipped_resolutions:
  packages:
    - name: elt-patches
      category: app-portage

    - name: eselect-opengl
      category: app-eselect

  categories:
    - virtual

#include_files:
#  - artefacts/file1.yml

build_template_file: templates/build-pkg.yaml.tmpl

artefacts:
- tree: multi-arch/packages
  packages:
    - sys-devel/gcc:9.3.0
    - app-emulation/lxd
    - app-emulation/lxc

# Define the list of the files generated by Funtoo reposcan tool.
reposcan_sources:
  - /tmp/kit_cache/gentoo-master
  - /tmp/kit_cache/geaaru_overlay-master

reposcan_contraints:
  packages:
    - dev-lang/python:3.7
    - sys-devel/gcc:9.3.0

reposcan_disabled_use_flags:
  - test
```

## Create anise specs

```
$> anise-portage-converter -- -t ./anise-packages-tree/ --to ./anise-packages-tree/ --rules config.yaml  --ignore-missing-deps

```
